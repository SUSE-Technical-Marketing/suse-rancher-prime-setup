defaultNamespace: suse-observability
helm:
  chart: suse-observability
  repo: https://charts.rancher.com/server-charts/prime/suse-observability
  version: 2.6.1 # This needs to be manualy updated
  releaseName: suse-observability
  values:
    stackstate:
      baseUrl: ${ if hasKey .ClusterAnnotations "hosted-domain" }https://observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }${ else}http://localhost${ end}
    ingress:
      ingressClassName: traefik
      hosts:
        - host: ${ if hasKey .ClusterAnnotations "hosted-domain" }observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }${ end}
      tls:
        - hosts: ${ if hasKey .ClusterAnnotations "hosted-domain" }[observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }]${ else}[]${ end}
          secretName: wildcard-tls
    opentelemetry-collector:
      ingress:
        ingressClassName: traefik
        hosts:
          - host: ${ if hasKey .ClusterAnnotations "hosted-domain" }otlp-observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }${ end}
            paths:
              - path: /
                pathType: Prefix
                port: 4317
        tls:
          - hosts: ${ if hasKey .ClusterAnnotations "hosted-domain" }[otlp-observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }]${ else}[]${ end}
            secretName: wildcard-tls
        additionalIngresses:
          - name: otlp-http
            ingressClassName: traefik
            hosts:
              - host: ${ if hasKey .ClusterAnnotations "hosted-domain" }otlp-http-observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }${ end}
                paths:
                  - path: /
                    pathType: Prefix
                    port: 4318
            tls:
              - hosts: ${ if hasKey .ClusterAnnotations "hosted-domain" }[otlp-http-observability.${ .ClusterName }.${ get .ClusterAnnotations "hosted-domain" }]${ else}[]${ end}
                secretName: wildcard-tls
  valuesFiles:
    - sizing_values.yaml
    - values.yaml
  valuesFrom:
    - secretKeyRef:
        name: fleet-secrets
        namespace: kube-system
        key: suse-observability-values.yaml
labels:
  provides: suse-observability
overrideTargets:
  - clusterSelector:
      matchLabels:
        needs-observability: "true"
diff:
  comparePatches:
    - apiVersion: batch/v1
      kind: Job
      namespace: suse-observability
      name: suse-observability-topic-create
      operations:
        - {"op": "ignore"}